
# ラグランジアンとラグランジュ方程式

## ダランベールの原理

質点系に作用する力 $\mathbf{F}_k$ と質点の加速度 $\mathbf{a}_k$ に対して，
ダランベールの原理は
$$
\sum_k \bigl(\mathbf{F}_k - m_k \mathbf{a}_k\bigr)\cdot\delta\mathbf{r}_k = 0
$$
と表される．ここで $\delta\mathbf{r}_k$ は許容される仮想変位である．

この式は「慣性力 $(-m_k\mathbf{a}_k)$ を含めた全ての力の仮想仕事の総和がゼロ」という意味を持つ．

## 一般化座標と一般化力

拘束条件のある系では，独立な自由度だけを一般化座標 $q_i$（$i=1,\dots,n$）としてとる(自由に座標を取れることを活かす)．質点 $k$ の位置ベクトルは
$$
\mathbf{r}_k = \mathbf{r}_k(q_1,\dots,q_n,t)
$$
と書けるとする．仮想変位は
$$
\delta\mathbf{r}_k = \sum_i \frac{\partial \mathbf{r}_k}{\partial q_i}\,\delta q_i
$$
と表せるので，ダランベールの原理は
$$
\begin{align}
0
&= \sum_k (\mathbf{F}_k - m_k\mathbf{a}_k)\cdot\delta\mathbf{r}_k \notag\\
&= \sum_k (\mathbf{F}_k - m_k\mathbf{a}_k)\cdot
    \sum_i \frac{\partial \mathbf{r}_k}{\partial q_i}\,\delta q_i \notag\\
&= \sum_i \left[
      \sum_k (\mathbf{F}_k - m_k\mathbf{a}_k)\cdot
              \frac{\partial \mathbf{r}_k}{\partial q_i}
    \right]\delta q_i.
\end{align}
$$
$\delta q_i$ は独立なので，係数がそれぞれゼロでなければならない：
$$
\sum_k (\mathbf{F}_k - m_k\mathbf{a}_k)\cdot
        \frac{\partial \mathbf{r}_k}{\partial q_i} = 0.
$$

ここで一般化力 $Q_i$ を
$$
Q_i = \sum_k \mathbf{F}_k\cdot\frac{\partial \mathbf{r}_k}{\partial q_i}
$$
と定義し，運動エネルギー $T$ の一般化座標による表現から
$$
\sum_k m_k\mathbf{a}_k\cdot\frac{\partial \mathbf{r}_k}{\partial q_i}
= \frac{d}{dt}\left(\frac{\partial T}{\partial \dot{q}_i}\right)
  - \frac{\partial T}{\partial q_i}
$$
が成り立つことを用いると，
$$
\frac{d}{dt}\left(\frac{\partial T}{\partial \dot{q}_i}\right)
- \frac{\partial T}{\partial q_i}
= Q_i
$$
を得る．これがラグランジュ形式の基本式である．

## 保存力とポテンシャルエネルギー

もし力が保存力であり，ポテンシャル $V(q)$ が存在して
$$
\mathbf{F}_k^{(\text{cons})} = -\nabla_{\mathbf{r}_k} V
$$
と書けるとき，一般化力の保存力部分は
$$
Q_i^{(\text{cons})} = -\frac{\partial V}{\partial q_i}
$$
となる．非保存力（摩擦や制御入力など）を $Q_i^{(\text{nc})}$ とすると，
全体の一般化力は
$$
Q_i = Q_i^{(\text{cons})} + Q_i^{(\text{nc})}
    = -\frac{\partial V}{\partial q_i} + Q_i^{(\text{nc})}.
$$

したがって
$$
\begin{align}
\frac{d}{dt}\left(\frac{\partial T}{\partial \dot{q}_i}\right)
- \frac{\partial T}{\partial q_i}
&= -\frac{\partial V}{\partial q_i} + Q_i^{(\text{nc})}
\end{align}
$$
となり，ラグランジアン $L = T - V$ を用いて
$$
\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{q}_i}\right)
- \frac{\partial L}{\partial q_i}
= Q_i^{(\text{nc})}
$$
を得る．

保存力のみの系（非保存力なし）では $Q_i^{(\text{nc})} = 0$ となり
$$
\boxed{
\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{q}_i}\right)
- \frac{\partial L}{\partial q_i}
= 0
}
$$
が成立する．

一方，ロボットアームのように関節トルク $\tau_i$ を外部から印加する場合，
$\tau_i$ はポテンシャルで表せない非保存力なので
$$
Q_i^{(\text{nc})} = \tau_i
$$
として
$$
\boxed{
\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{\theta}_i}\right)
- \frac{\partial L}{\partial \theta_i}
= \tau_i
}
$$
となる．これは行列表現にまとめると
$$
M(\theta)\ddot{\theta} + C(\theta,\dot{\theta})\dot{\theta} + G(\theta) = \tau
$$
という形に対応する．

